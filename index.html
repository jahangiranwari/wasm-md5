<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MD5 using Wasm</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="js/md5.umd.min.js"></script>
    <script defer src="js/hasher.js"></script>
  </head>

  <body>
    <form>
      <h1>MD5 using WebAssembly</h1>
      <label for="file-input">Choose a file</label>
      <input type="file" id="file-input" class="hidden">
      <h3 id="processing" class="hidden">Computing hash...</h3>
      <div id="result"></div>
    </form>

    <script>
      (() => {
        const fileSelector = document.getElementById("file-input");
        const resultElement = document.getElementById("result");
        const processingEl = document.getElementById("processing");

        fileSelector.addEventListener("change", async(event) => {
          const file = event.target.files[0];
          processingEl.classList.remove('hidden')
          resultElement.innerHTML = "Loading...";

          // Compute hash
          const start = Date.now();
          const hasher = new Hasher(file);
          const hash = await hasher.getMD5();
          const end = Date.now();

          // Display hash and processing results
          const duration = end - start;
          const fileSizeMB = file.size / 1024 / 1024;
          const throughput = fileSizeMB / (duration / 1000);
          processingEl.classList.remove('hidden');
          resultElement.innerHTML = `
            Hash: ${hash}<br>
            Duration: ${duration} ms<br>
            Throughput: ${throughput.toFixed(2)} MB/s
          `;
        });
      })();
    </script>
  </body>
</html>
